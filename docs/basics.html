<html><head><title>formulation: The basics</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Vectos" /><meta name="description" content="Describe Avro data types" /><meta name="og:image" content="/formulation/img/poster.png" /><meta name="og:title" content="formulation: The basics" /><meta name="og:site_name" content="formulation" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Describe Avro data types" /><link rel="icon" type="image/png" href="/formulation/img/favicon.png" /><meta name="twitter:title" content="formulation: The basics" /><meta name="twitter:image" content="img/poster.png" /><meta name="twitter:description" content="Describe Avro data types" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@mark_dj" /><link rel="icon" type="image/png" sizes="16x16" href="/formulation/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/formulation/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/formulation/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/formulation/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/formulation/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/formulation/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/formulation/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/formulation/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/formulation/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/formulation/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/formulation/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/formulation/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/formulation/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/formulation/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/formulation/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/formulation/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/formulation/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/formulation/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/formulation/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/formulation/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/formulation/highlight/styles/default.css" /><link rel="stylesheet" href="/formulation/css/style.css" /><link rel="stylesheet" href="/formulation/css/palette.css" /><link rel="stylesheet" href="/formulation/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/formulation/" class="brand"><div class="brand-wrapper"><span>formulation</span></div></a></li> <li><a href="/formulation/docs/index.html" class="">Getting Started</a></li> <li><a href="/formulation/docs/basics.html" class="">Basics</a></li> <li><a href="/formulation/docs/richer-data-types.html" class="">Imap, pmap and sum types</a></li> <li><a href="/formulation/docs/schema-registry.html" class="">Schema Registry</a></li> <li><a href="/formulation/docs/refined.html" class="">Support for refinement types</a></li> <li><a href="/formulation/docs/akka-stream.html" class="">Akka stream</a></li> <li><a href="/formulation/docs/akka-serializer.html" class="">Akka serializer</a></li> <li><a href="/formulation/docs/performance.html" class="">Performance</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/vectos/formulation"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/vectos/formulation"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('formulation Describe Avro data types');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('formulation Describe Avro data types');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="vectos" data-github-repo="formulation"><div class="content-wrapper"><section><h1 id="the-basics">The basics</h1>

<h2 id="supported-primitives">Supported primitives</h2>

<p>Every <strong>combinator</strong> listed below will return a <code class="highlighter-rouge">Avro[A]</code> (where <code class="highlighter-rouge">A</code> is the <strong>type</strong>).</p>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Combinator</th>
      <th>Remark</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">Int</code></td>
      <td><code class="highlighter-rouge">int</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">String</code></td>
      <td><code class="highlighter-rouge">string</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Float</code></td>
      <td><code class="highlighter-rouge">float</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Double</code></td>
      <td><code class="highlighter-rouge">double</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Long</code></td>
      <td><code class="highlighter-rouge">long</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Option[A]</code></td>
      <td><code class="highlighter-rouge">option</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Vector[A]</code></td>
      <td><code class="highlighter-rouge">vector</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Map[String, A]</code></td>
      <td><code class="highlighter-rouge">map</code></td>
      <td>You can contramap/map the key <code class="highlighter-rouge">String</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">List[A]</code></td>
      <td><code class="highlighter-rouge">list</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Set[A]</code></td>
      <td><code class="highlighter-rouge">set</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Seq[A]</code></td>
      <td><code class="highlighter-rouge">seq</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Either[L, R]</code></td>
      <td><code class="highlighter-rouge">or</code></td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Array[Byte]</code></td>
      <td><code class="highlighter-rouge">byteArray</code></td>
      <td>It’s encoded as bytes (<code class="highlighter-rouge">ByteBuffer</code>)</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">BigDecimal</code></td>
      <td><code class="highlighter-rouge">bigDecimal</code></td>
      <td>Uses <code class="highlighter-rouge">byteArray</code> under the hood, it’s encoded as bytes</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">java.util.UUID</code></td>
      <td><code class="highlighter-rouge">uuid</code></td>
      <td>Uses <code class="highlighter-rouge">string</code> under the hood</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">java.time.Instant</code></td>
      <td><code class="highlighter-rouge">instant</code></td>
      <td>Uses <code class="highlighter-rouge">long</code> under the hood</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">java.time.LocalDate</code></td>
      <td><code class="highlighter-rouge">localDate</code></td>
      <td>Uses <code class="highlighter-rouge">string</code> under the hood using (<code class="highlighter-rouge">DateTimeFormatter.ISO_LOCAL_DATE</code>)</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">java.time.LocalDateTime</code></td>
      <td><code class="highlighter-rouge">localDateTime</code></td>
      <td>Uses <code class="highlighter-rouge">string</code> under the hood using (<code class="highlighter-rouge">DateTimeFormatter.ISO_LOCAL_DATE_TIME</code>)</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">java.time.ZonedDateTime</code></td>
      <td><code class="highlighter-rouge">zonedDateTime </code></td>
      <td>Uses <code class="highlighter-rouge">string</code> under the hood using (<code class="highlighter-rouge">DateTimeFormatter.ISO_ZONED_DATE_TIME</code>)</td>
    </tr>
  </tbody>
</table>

<h2 id="records-up-till-max-arity-22-fields">Records up till max arity (22 fields)</h2>

<p>To define records you use the combinator <code class="highlighter-rouge">recordN</code> (where N = 1 till 22). The record combinator requires you to specify a namespace and name. Never change the name and namespace if you want to maintain compatibility!</p>

<p>Also per field you need to provide a pair of a field name (also never change this if you want to maintain compatibility) and a description of the member</p>

<ul>
  <li>Which type (use the combinators above)</li>
  <li>How to access it (getter)</li>
  <li>Default value (see below)</li>
</ul>

<p>We could add aliases later.</p>

<h2 id="encode-and-decode">encode and decode</h2>

<p>By using <code class="highlighter-rouge">import formulation._</code> you can use the <code class="highlighter-rouge">encode</code> and <code class="highlighter-rouge">decode</code> when there is a implicit <code class="highlighter-rouge">Avro[A]</code></p>

<p>The type signature of <code class="highlighter-rouge">encode</code> looks like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def encode[A](value: A)(implicit R: AvroEncoder[A], S: AvroSchema[A]): Array[Byte]
</code></pre></div></div>

<p>When there is a <code class="highlighter-rouge">Avro[A]</code> implicitly available we can summon a <code class="highlighter-rouge">AvroEncoder[A]</code> and a <code class="highlighter-rouge">AvroSchema[A]</code> as well.</p>

<p>The type signature of <code class="highlighter-rouge">decode</code> looks like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def decode[A](bytes: Array[Byte], writerSchema: Option[Schema] = None, readerSchema: Option[Schema] = None)(implicit R: AvroDecoder[A], S: AvroSchema[A]): Either[AvroDecodeFailure, A]
</code></pre></div></div>

<p>You can provide a <code class="highlighter-rouge">writerSchema</code> in case you know the schema it’s written with. If it’s not supplied it will default to the <code class="highlighter-rouge">S: AvroSchema[A]</code>.</p>

<h2 id="generate-schemas">Generate schemas</h2>

<p>When you have a implicit <code class="highlighter-rouge">Avro[A]</code> available you can use <code class="highlighter-rouge">schema[A]</code> to get a <code class="highlighter-rouge">org.apache.avro.Schema</code></p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">UserV1</span><span class="o">(</span><span class="n">userId</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">username</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">email</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">password</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">codecV1</span><span class="k">:</span> <span class="kt">Avro</span><span class="o">[</span><span class="kt">UserV1</span><span class="o">]</span> <span class="k">=</span> <span class="n">record4</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="s">"User"</span><span class="o">)(</span><span class="nc">UserV1</span><span class="o">.</span><span class="n">apply</span><span class="o">)(</span>
  <span class="s">"userId"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">int</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">userId</span><span class="o">),</span>
  <span class="s">"username"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">string</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">username</span><span class="o">),</span>
  <span class="s">"email"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">string</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">email</span><span class="o">),</span>
  <span class="s">"password"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">string</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">password</span><span class="o">)</span>
<span class="o">)</span>
</code></pre></div></div>

<p>Print it</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">schema</span><span class="o">[</span><span class="kt">UserV1</span><span class="o">].</span><span class="n">toString</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="n">res1</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
<span class="o">{</span>
  <span class="s">"type"</span> <span class="k">:</span> <span class="err">"</span><span class="kt">record</span><span class="err">"</span><span class="o">,</span>
  <span class="s">"name"</span> <span class="k">:</span> <span class="err">"</span><span class="kt">User</span><span class="err">"</span><span class="o">,</span>
  <span class="s">"namespace"</span> <span class="k">:</span> <span class="err">"</span><span class="kt">user</span><span class="err">"</span><span class="o">,</span>
  <span class="s">"doc"</span> <span class="k">:</span> <span class="err">""</span><span class="o">,</span>
  <span class="s">"fields"</span> <span class="k">:</span> <span class="err">[</span> <span class="o">{</span>
    <span class="err">"</span><span class="kt">name</span><span class="err">"</span> <span class="kt">:</span> <span class="err">"</span><span class="kt">userId</span><span class="err">"</span><span class="o">,</span>
    <span class="err">"</span><span class="k">type</span><span class="err">"</span> <span class="kt">:</span> <span class="err">"</span><span class="kt">int</span><span class="err">"</span>
  <span class="o">},</span> <span class="o">{</span>
    <span class="s">"name"</span> <span class="k">:</span> <span class="err">"</span><span class="kt">username</span><span class="err">"</span><span class="o">,</span>
    <span class="s">"type"</span> <span class="k">:</span> <span class="err">"</span><span class="kt">string</span><span class="err">"</span>
  <span class="o">},</span> <span class="o">{</span>
    <span class="s">"name"</span> <span class="k">:</span> <span class="err">"</span><span class="kt">email</span><span class="err">"</span><span class="o">,</span>
    <span class="s">"type"</span> <span class="k">:</span> <span class="err">"</span><span class="kt">string</span><span class="err">"</span>
  <span class="o">},</span> <span class="o">{</span>
    <span class="s">"name"</span> <span class="k">:</span> <span class="err">"</span><span class="kt">password</span><span class="err">"</span><span class="o">,</span>
    <span class="s">"type"</span> <span class="k">:</span> <span class="err">"</span><span class="kt">string</span><span class="err">"</span>
  <span class="o">}</span> <span class="err">]</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="default-values">Default values</h3>

<p>Above we defined <code class="highlighter-rouge">UserV1</code>, what if we have <code class="highlighter-rouge">UserV2</code> which has extra fields and we want to be full compatible? We need to define default values for the new fields <code class="highlighter-rouge">age</code>, <code class="highlighter-rouge">countries</code>, <code class="highlighter-rouge">bookingProcess</code> and <code class="highlighter-rouge">money</code>. Note <code class="highlighter-rouge">defaultValue</code> in the <code class="highlighter-rouge">member</code> method.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">UserV2</span><span class="o">(</span>
                   <span class="n">userId</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span>
                   <span class="n">username</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
                   <span class="n">email</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
                   <span class="n">password</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
                   <span class="n">age</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span>
                   <span class="n">countries</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span>
                   <span class="n">money</span><span class="k">:</span> <span class="kt">BigDecimal</span>
                 <span class="o">)</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">codecV2</span><span class="k">:</span> <span class="kt">Avro</span><span class="o">[</span><span class="kt">UserV2</span><span class="o">]</span> <span class="k">=</span> <span class="n">record7</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="s">"User"</span><span class="o">)(</span><span class="nc">UserV2</span><span class="o">.</span><span class="n">apply</span><span class="o">)(</span>
    <span class="s">"userId"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">int</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">userId</span><span class="o">),</span>
    <span class="s">"username"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">string</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">username</span><span class="o">),</span>
    <span class="s">"email"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">string</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">email</span><span class="o">),</span>
    <span class="s">"password"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">string</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">password</span><span class="o">),</span>
    <span class="s">"age"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">option</span><span class="o">(</span><span class="n">int</span><span class="o">),</span> <span class="k">_</span><span class="o">.</span><span class="n">age</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">None</span><span class="o">)),</span>
    <span class="s">"countries"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">list</span><span class="o">(</span><span class="n">string</span><span class="o">),</span> <span class="k">_</span><span class="o">.</span><span class="n">countries</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="s">"Holland"</span><span class="o">))),</span>
    <span class="s">"money"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">bigDecimal</span><span class="o">(</span><span class="mi">300</span><span class="o">,</span> <span class="mi">300</span><span class="o">),</span> <span class="k">_</span><span class="o">.</span><span class="n">money</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">1000</span><span class="o">))</span>
<span class="o">)</span>
</code></pre></div></div>

<p>These values are also outputted in the JSON of the schema.</p>

<h2 id="compatibility-checks">Compatibility checks</h2>

<p><code class="highlighter-rouge">AvroSchemaCompatibility.Full</code> as <code class="highlighter-rouge">v2</code> has default values</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="nc">AvroSchemaCompatibility</span><span class="o">(</span><span class="n">schema</span><span class="o">[</span><span class="kt">UserV1</span><span class="o">],</span> <span class="n">schema</span><span class="o">[</span><span class="kt">UserV2</span><span class="o">])</span>
<span class="n">res3</span><span class="k">:</span> <span class="kt">formulation.AvroSchemaCompatibility</span> <span class="o">=</span> <span class="nc">Full</span>
</code></pre></div></div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/formulation/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/formulation/js/main.js"></script></body></html>