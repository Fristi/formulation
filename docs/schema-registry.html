<html><head><title>formulation: Schema registry</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Vectos" /><meta name="description" content="Describe Avro data types" /><meta name="og:image" content="/formulation/img/poster.png" /><meta name="og:title" content="formulation: Schema registry" /><meta name="og:site_name" content="formulation" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Describe Avro data types" /><link rel="icon" type="image/png" href="/formulation/img/favicon.png" /><meta name="twitter:title" content="formulation: Schema registry" /><meta name="twitter:image" content="img/poster.png" /><meta name="twitter:description" content="Describe Avro data types" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@mark_dj" /><link rel="icon" type="image/png" sizes="16x16" href="/formulation/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/formulation/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/formulation/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/formulation/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/formulation/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/formulation/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/formulation/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/formulation/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/formulation/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/formulation/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/formulation/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/formulation/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/formulation/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/formulation/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/formulation/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/formulation/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/formulation/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/formulation/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/formulation/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/formulation/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/formulation/highlight/styles/default.css" /><link rel="stylesheet" href="/formulation/css/style.css" /><link rel="stylesheet" href="/formulation/css/palette.css" /><link rel="stylesheet" href="/formulation/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/formulation/" class="brand"><div class="brand-wrapper"><span>formulation</span></div></a></li> <li><a href="/formulation/docs/index.html" class="">Getting Started</a></li> <li><a href="/formulation/docs/basics.html" class="">Basics</a></li> <li><a href="/formulation/docs/richer-data-types.html" class="">Imap, pmap and sum types</a></li> <li><a href="/formulation/docs/schema-registry.html" class="">Schema Registry</a></li> <li><a href="/formulation/docs/refined.html" class="">Support for refinement types</a></li> <li><a href="/formulation/docs/akka-stream.html" class="">Akka stream</a></li> <li><a href="/formulation/docs/akka-serializer.html" class="">Akka serializer</a></li> <li><a href="/formulation/docs/performance.html" class="">Performance</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/vectos/formulation"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/vectos/formulation"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('formulation Describe Avro data types');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('formulation Describe Avro data types');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="vectos" data-github-repo="formulation"><div class="content-wrapper"><section><h1 id="schema-registry">Schema registry</h1>

<h3 id="what-is-schema-registry">What is schema registry?</h3>

<p>Schema registry is a centralised database for storing <code class="highlighter-rouge">Schema</code>’s. The <code class="highlighter-rouge">Schema</code>’s are stored per subject and per subject it’s
possible to enforce compatibility. Each <code class="highlighter-rouge">Schema</code> also has a identifier in the schema registry. 
This identifier is used to put next to a Avro payload, such that it’s not required to send the <code class="highlighter-rouge">Schema</code> with each message.</p>

<h3 id="wire-format">Wire format</h3>
<p>In formulation we use the standardised wire format of Confluent, which can be found <a href="https://docs.confluent.io/current/schema-registry/docs/serializer-formatter.html#wire-format">here</a></p>

<h3 id="use-cases">Use cases</h3>
<p>Using this wire format can be useful in many applications where full, backward or forward compatibility is required. Examples
of use cases are for example</p>

<ul>
  <li>Produce/consume messages to/from Kafka</li>
  <li>Store/receive payloads to/from Redis</li>
  <li>Store/receive events to/from a event journal (akka-persistence)</li>
</ul>

<h3 id="using-it">Using it</h3>

<p>The “reference” implementation of schema registry is developed by Confluent (maintainers and new development of Kafka).
It is a REST API for this which is based on Kafka/Java. For this API there is a docker image available <a href="https://hub.docker.com/r/confluentinc/cp-schema-registry/">here</a>.
It’s usually nice to run something like the <a href="https://hub.docker.com/r/landoop/fast-data-dev/">fast-data-dev</a> stack while development, to inspect messages put on Kafka and inspect the
schema registry.</p>

<p>The API is pretty easy and could also be implemented in terms of a SQL database, K/V store or maybe even a CRDT based one.</p>

<h2 id="how-to-use-it-in-formulation">How to use it in formulation</h2>

<p>Let’s start with some imports</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">formulation._</span>
<span class="k">import</span> <span class="nn">formulation.schemaregistry._</span>
</code></pre></div></div>

<h2 id="data-types-used-in-formulation">Data types used in formulation</h2>

<p>This will bring in <code class="highlighter-rouge">SchemaRegistry</code>. The <code class="highlighter-rouge">SchemaRegistry</code> is defined as a tagless final. Let’s have a look at the constructor of <code class="highlighter-rouge">SchemaRegistry</code>. Note that the effect type is not set yet:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">client</span><span class="k">:</span> <span class="kt">SchemaRegistryClient</span><span class="o">[</span><span class="kt">F</span><span class="o">])(</span><span class="k">implicit</span> <span class="n">F</span><span class="k">:</span> <span class="kt">MonadError</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Throwable</span><span class="o">])</span><span class="k">:</span> <span class="kt">SchemaRegistry</span><span class="o">[</span><span class="kt">F</span><span class="o">]</span>
</code></pre></div></div>

<p>The effect type is constrained to be a <code class="highlighter-rouge">MonadError[F, Throwable]</code>. This means the effect type needs to be able to raise errors
as <code class="highlighter-rouge">Throwable</code>. Examples of effect types which are supported are:</p>

<ul>
  <li><code class="highlighter-rouge">scala.util.Try</code> - for synchronous computations</li>
  <li><code class="highlighter-rouge">scala.concurrent.Future</code> - for asynchronous computations</li>
  <li><code class="highlighter-rouge">cats.effect.IO</code> - for synchronous/asynchronous computations</li>
</ul>

<p>Note that you need to have type class instances in scope to make this work. Typically this means <code class="highlighter-rouge">import cats.implicits._</code> (as <code class="highlighter-rouge">MonadError</code> comes from <strong>cats</strong>)</p>

<p>The most notable methods on <code class="highlighter-rouge">SchemaRegistry</code> are:</p>

<ul>
  <li><code class="highlighter-rouge">def encode[A: AvroSchema : AvroEncoder](value: A): F[Array[Byte]]</code> - Encodes a entity using the wire format</li>
  <li><code class="highlighter-rouge">def decode[A: AvroSchema : AvroDecoder](bytes: Array[Byte]): F[Either[AvroDecodeFailure, A]]</code> - Decodes a entity using the wire format</li>
  <li><code class="highlighter-rouge">def verifyCompatibility[A](avro: Avro[A], desired: AvroSchemaCompatibility = AvroSchemaCompatibility.Full): F[List[SchemaRegistryCompatibilityResult]]</code> - Checks the compatibility</li>
  <li><code class="highlighter-rouge">def registerSchemas[A](avro: Avro[A]): F[List[SchemaRegistryRegisterResult]]</code> - Registers the schema’s</li>
</ul>

<p>The <code class="highlighter-rouge">SchemaRegistryClient</code> trait is also defined in tagless final manner:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">SchemaRegistryClient</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">getSchemaById</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Schema</span><span class="o">]]</span>
  <span class="k">def</span> <span class="n">getIdBySchema</span><span class="o">(</span><span class="n">schema</span><span class="k">:</span> <span class="kt">Schema</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span>
  <span class="k">def</span> <span class="n">registerSchema</span><span class="o">(</span><span class="n">schema</span><span class="k">:</span> <span class="kt">Schema</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">checkCompatibility</span><span class="o">(</span><span class="n">schema</span><span class="k">:</span> <span class="kt">Schema</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span>
  <span class="k">def</span> <span class="n">getCompatibilityLevel</span><span class="o">(</span><span class="n">subject</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">AvroSchemaCompatibility</span><span class="o">]]</span>
  <span class="k">def</span> <span class="n">setCompatibilityLevel</span><span class="o">(</span><span class="n">subject</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">desired</span><span class="k">:</span> <span class="kt">AvroSchemaCompatibility</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">AvroSchemaCompatibility</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The first two methods are the most frequently used methods.</p>
<ul>
  <li><code class="highlighter-rouge">getSchemaById</code> - is used while decoding</li>
  <li><code class="highlighter-rouge">getIdBySchema</code> - is used while encoding</li>
</ul>

<p>For that reason we suggest to cache these calls (by using Scalacache, scroll down to see how we support that)</p>

<h2 id="top-level-union-types">Top level union types</h2>

<p>When you define a top level union (sum type) and you either register this or you check compatibility, <code class="highlighter-rouge">SchemaRegistry</code> will get all the schema’s from the <strong>UNION</strong> schema and for each
schema in the <strong>UNION</strong> it will register or verify compatibility individually. So for example this algebraic data type:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">java.time.Instant</span>

<span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Event</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Completed</span><span class="o">(</span><span class="n">at</span><span class="k">:</span> <span class="kt">Instant</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Event</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Failed</span><span class="o">(</span><span class="n">at</span><span class="k">:</span> <span class="kt">Instant</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Event</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Started</span><span class="o">(</span><span class="n">at</span><span class="k">:</span> <span class="kt">Instant</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Event</span>

<span class="k">val</span> <span class="n">completedAvroCodec</span><span class="k">:</span> <span class="kt">Avro</span><span class="o">[</span><span class="kt">Completed</span><span class="o">]</span> <span class="k">=</span> <span class="n">record1</span><span class="o">(</span><span class="s">"event"</span><span class="o">,</span> <span class="s">"Completed"</span><span class="o">)(</span><span class="nc">Completed</span><span class="o">.</span><span class="n">apply</span><span class="o">)(</span><span class="s">"at"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">instant</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">at</span><span class="o">))</span>
<span class="k">val</span> <span class="n">failedAvroCodec</span><span class="k">:</span> <span class="kt">Avro</span><span class="o">[</span><span class="kt">Failed</span><span class="o">]</span> <span class="k">=</span> <span class="n">record1</span><span class="o">(</span><span class="s">"event"</span><span class="o">,</span> <span class="s">"Failed"</span><span class="o">)(</span><span class="nc">Failed</span><span class="o">.</span><span class="n">apply</span><span class="o">)(</span><span class="s">"at"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">instant</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">at</span><span class="o">))</span>
<span class="k">val</span> <span class="n">startedAvroCodec</span><span class="k">:</span> <span class="kt">Avro</span><span class="o">[</span><span class="kt">Started</span><span class="o">]</span> <span class="k">=</span> <span class="n">record1</span><span class="o">(</span><span class="s">"event"</span><span class="o">,</span> <span class="s">"Started"</span><span class="o">)(</span><span class="nc">Started</span><span class="o">.</span><span class="n">apply</span><span class="o">)(</span><span class="s">"at"</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">(</span><span class="n">instant</span><span class="o">,</span> <span class="k">_</span><span class="o">.</span><span class="n">at</span><span class="o">))</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">eventAvroCodec</span><span class="k">:</span> <span class="kt">Avro</span><span class="o">[</span><span class="kt">Event</span><span class="o">]</span> <span class="k">=</span> <span class="o">(</span><span class="n">completedAvroCodec</span> <span class="o">|</span> <span class="n">failedAvroCodec</span> <span class="o">|</span> <span class="n">startedAvroCodec</span><span class="o">).</span><span class="n">as</span><span class="o">[</span><span class="kt">Event</span><span class="o">]</span>
</code></pre></div></div>

<p>Will cause three registration and verify compatibility calls with the  <code class="highlighter-rouge">SchemaRegistryClient</code>. The subjects used are <code class="highlighter-rouge">event.Completed</code>, <code class="highlighter-rouge">event.Failed</code> and <code class="highlighter-rouge">event.Started</code>. 
We did that because sometimes you want to add or remove a case from an algebraic data type without breaking the compatibility. 
In standard Avro, if you would add or remove a union member, it will break compatibility.</p>

<h2 id="sttp-support">Sttp support</h2>

<p>To interact with the Confluent schema registry API we’ve implemented a <code class="highlighter-rouge">ConfluentSttpSchemaRegistryClient</code> which you can get by using the <code class="highlighter-rouge">formulation-schema-registry-confluent-sttp</code> module.</p>

<p>Example of using it:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.softwaremill.sttp.TryHttpURLConnectionBackend</span>
<span class="k">import</span> <span class="nn">formulation.schemaregistry.confluent.sttp.ConfluentSttpSchemaRegistryClient</span>
<span class="k">import</span> <span class="nn">cats.implicits._</span> <span class="c1">// note: you need this for `MonadError[Try, Throwable]`
</span>
<span class="k">val</span> <span class="n">catsSttpBackend</span> <span class="k">=</span> <span class="nc">TryHttpURLConnectionBackend</span><span class="o">()</span>
<span class="k">val</span> <span class="n">confluentSttpSchemaRegistryClient</span> <span class="k">=</span> <span class="nc">ConfluentSttpSchemaRegistryClient</span><span class="o">(</span><span class="s">"http://localhost:8081"</span><span class="o">,</span> <span class="n">catsSttpBackend</span><span class="o">)</span>
</code></pre></div></div>

<p>Note that you can use different sttp backends as described in the documentation of <a href="http://sttp.readthedocs.io/en/latest/backends/summary.html">sttp</a></p>

<h2 id="scalacache-support">Scalacache support</h2>

<p>As said above, we would like to cache the calls <code class="highlighter-rouge">getSchemaById</code> and <code class="highlighter-rouge">getIdBySchema</code>. For that reason we can use <a href="https://github.com/cb372/scalacache">scalacache</a>.
You can get by using the <code class="highlighter-rouge">formulation-schema-registry-scalacache</code> module.</p>

<p>Example of using it with Caffeine:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.github.benmanes.caffeine.cache.Caffeine</span>
<span class="k">import</span> <span class="nn">org.apache.avro.Schema</span>
<span class="k">import</span> <span class="nn">_root_.scalacache.Entry</span>
<span class="k">import</span> <span class="nn">_root_.scalacache.modes.try_._</span> <span class="c1">// note: need this for running as `Try`
</span><span class="k">import</span> <span class="nn">_root_.scalacache.caffeine.CaffeineCache</span>
<span class="k">import</span> <span class="nn">formulation.schemaregistry.scalacache.ScalacacheSchemaRegistryClient</span>

<span class="k">val</span> <span class="n">schemaCache</span> <span class="k">=</span> <span class="nc">Caffeine</span><span class="o">.</span><span class="n">newBuilder</span><span class="o">().</span><span class="n">recordStats</span><span class="o">().</span><span class="n">maximumSize</span><span class="o">(</span><span class="mi">10000L</span><span class="o">).</span><span class="n">build</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Entry</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span>
<span class="k">val</span> <span class="n">idCache</span> <span class="k">=</span> <span class="nc">Caffeine</span><span class="o">.</span><span class="n">newBuilder</span><span class="o">().</span><span class="n">recordStats</span><span class="o">().</span><span class="n">maximumSize</span><span class="o">(</span><span class="mi">10000L</span><span class="o">).</span><span class="n">build</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Entry</span><span class="o">[</span><span class="kt">Schema</span><span class="o">]]</span>
<span class="k">val</span> <span class="n">cachedRegistryClient</span> <span class="k">=</span> <span class="nc">ScalacacheSchemaRegistryClient</span><span class="o">(</span><span class="n">confluentSttpSchemaRegistryClient</span><span class="o">,</span> <span class="nc">CaffeineCache</span><span class="o">(</span><span class="n">schemaCache</span><span class="o">),</span> <span class="nc">CaffeineCache</span><span class="o">(</span><span class="n">idCache</span><span class="o">))</span>
</code></pre></div></div>

<p>Depending on how you want to cache the schema’s you could either go for caffeine (cached per machine) or a distributed cache like Redis.</p>

<h3 id="using-the-schema-registry">Using the schema registry</h3>

<p>Now we’ve set up the clients we can use it:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">schemaRegistry</span> <span class="k">=</span> <span class="nc">SchemaRegistry</span><span class="o">(</span><span class="n">cachedRegistryClient</span><span class="o">)</span>
</code></pre></div></div>

<p>Let’s register</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">schemaRegistry</span><span class="o">.</span><span class="n">registerSchemas</span><span class="o">(</span><span class="n">eventAvroCodec</span><span class="o">)</span>
<span class="n">res6</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">formulation.schemaregistry.SchemaRegistryRegisterResult</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="nc">SchemaRegistryRegisterResult</span><span class="o">({</span><span class="s">"type"</span><span class="k">:</span><span class="err">"</span><span class="kt">record</span><span class="err">"</span><span class="o">,</span><span class="s">"name"</span><span class="k">:</span><span class="err">"</span><span class="kt">Started</span><span class="err">"</span><span class="o">,</span><span class="s">"namespace"</span><span class="k">:</span><span class="err">"</span><span class="kt">event</span><span class="err">"</span><span class="o">,</span><span class="s">"doc"</span><span class="k">:</span><span class="err">""</span><span class="o">,</span><span class="s">"fields"</span><span class="k">:</span><span class="err">[</span><span class="o">{</span><span class="err">"</span><span class="kt">name</span><span class="err">"</span><span class="kt">:</span><span class="err">"</span><span class="kt">at</span><span class="err">"</span><span class="o">,</span><span class="err">"</span><span class="k">type</span><span class="err">"</span><span class="kt">:</span><span class="o">{</span><span class="err">"</span><span class="k">type</span><span class="err">"</span><span class="kt">:</span><span class="err">"</span><span class="kt">long</span><span class="err">"</span><span class="o">,</span><span class="err">"</span><span class="kt">logicalType</span><span class="err">"</span><span class="kt">:</span><span class="err">"</span><span class="kt">timestamp-millis</span><span class="err">"</span><span class="o">}}</span><span class="err">]</span><span class="o">},</span><span class="mi">1</span><span class="o">),</span> <span class="nc">SchemaRegistryRegisterResult</span><span class="o">({</span><span class="s">"type"</span><span class="k">:</span><span class="err">"</span><span class="kt">record</span><span class="err">"</span><span class="o">,</span><span class="s">"name"</span><span class="k">:</span><span class="err">"</span><span class="kt">Completed</span><span class="err">"</span><span class="o">,</span><span class="s">"namespace"</span><span class="k">:</span><span class="err">"</span><span class="kt">event</span><span class="err">"</span><span class="o">,</span><span class="s">"doc"</span><span class="k">:</span><span class="err">""</span><span class="o">,</span><span class="s">"fields"</span><span class="k">:</span><span class="err">[</span><span class="o">{</span><span class="err">"</span><span class="kt">name</span><span class="err">"</span><span class="kt">:</span><span class="err">"</span><span class="kt">at</span><span class="err">"</span><span class="o">,</span><span class="err">"</span><span class="k">type</span><span class="err">"</span><span class="kt">:</span><span class="o">{</span><span class="err">"</span><span class="k">type</span><span class="err">"</span><span class="kt">:</span><span class="err">"</span><span class="kt">long</span><span class="err">"</span><span class="o">,</span><span class="err">"</span><span class="kt">logicalType</span><span class="err">"</span><span class="kt">:</span><span class="err">"</span><span class="kt">timestamp-millis</span><span class="err">"</span><span class="o">}}</span><span class="err">]</span><span class="o">},</span><span class="mi">2</span><span class="o">),</span> <span class="nc">SchemaRegistryRegisterResult</span><span class="o">({</span><span class="s">"type"</span><span class="k">:</span><span class="err">"</span><span class="kt">record</span><span class="err">"</span><span class="o">,</span><span class="s">"name"</span><span class="k">:</span><span class="err">"</span><span class="kt">Failed</span><span class="err">"</span><span class="o">,</span><span class="s">"namespace"</span><span class="k">:</span><span class="err">"</span><span class="kt">event</span><span class="err">"</span><span class="o">,</span><span class="s">"doc"</span><span class="k">:</span><span class="err">""</span><span class="o">,</span><span class="s">"fields"</span><span class="k">:</span><span class="err">[</span><span class="o">{</span><span class="err">"</span><span class="kt">name</span><span class="err">"</span><span class="kt">:</span><span class="err">"</span><span class="kt">at</span><span class="err">"</span><span class="o">,</span><span class="err">"</span><span class="k">type</span><span class="err">"</span><span class="kt">:</span><span class="o">{</span><span class="err">"</span><span class="k">type</span><span class="err">"</span><span class="kt">:</span><span class="err">"</span><span class="kt">long</span><span class="err">"</span><span class="o">,</span><span class="err">"</span><span class="kt">logicalType</span><span class="err">"</span><span class="kt">:</span><span class="err">"</span><span class="kt">timestamp-millis</span><span class="err">"</span><span class="o">}}</span><span class="err">]</span><span class="o">},</span><span class="mi">3</span><span class="o">)))</span>
</code></pre></div></div>

<p>Let’s encode and decode</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">for</span> <span class="o">{</span>
     <span class="o">|</span>     <span class="n">bytes</span> <span class="k">&lt;-</span> <span class="n">schemaRegistry</span><span class="o">.</span><span class="n">encode</span><span class="o">(</span><span class="nc">Completed</span><span class="o">(</span><span class="nc">Instant</span><span class="o">.</span><span class="n">now</span><span class="o">)</span> <span class="k">:</span> <span class="kt">Event</span><span class="o">)</span>
     <span class="o">|</span>     <span class="n">result</span> <span class="k">&lt;-</span> <span class="n">schemaRegistry</span><span class="o">.</span><span class="n">decode</span><span class="o">[</span><span class="kt">Event</span><span class="o">](</span><span class="n">bytes</span><span class="o">)</span>
     <span class="o">|</span> <span class="o">}</span> <span class="k">yield</span> <span class="n">result</span>
<span class="n">res7</span><span class="k">:</span> <span class="kt">scala.util.Try</span><span class="o">[</span><span class="kt">Either</span><span class="o">[</span><span class="kt">formulation.AvroDecodeFailure</span>,<span class="kt">Event</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">Success</span><span class="o">(</span><span class="nc">Right</span><span class="o">(</span><span class="nc">Completed</span><span class="o">(</span><span class="mi">2018</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">14</span><span class="n">T07</span><span class="k">:</span><span class="err">42</span><span class="kt">:</span><span class="err">19</span><span class="kt">.</span><span class="err">209</span><span class="kt">Z</span><span class="o">)))</span>
</code></pre></div></div>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/formulation/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/formulation/js/main.js"></script></body></html>